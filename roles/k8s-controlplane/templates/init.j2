# https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-init/
# https://kubernetes.io/docs/reference/config-api/kubeadm-config.v1beta3/

apiVersion: kubeadm.k8s.io/v1beta3
kind: InitConfiguration
nodeRegistration:
  criSocket: "unix:///run/containerd/containerd.sock" 
  kubeletExtraArgs: 
    node-labels: node.{{ config.label_domain }}/lifetime=persistent

skipPhases: 
  - addon/kube-proxy    # skip in favor of cilium
---
apiVersion: kubeadm.k8s.io/v1beta3
kind: ClusterConfiguration
controlPlaneEndpoint: {{ config.control_plane_endpoint }}:{{ config.apiserver_port }}
networking:
  # serviceSubnet: config.cluster_ipv4_service_cidrs
  # podSubnet: config.cluster_ipv4_pod_cidrs
  dnsDomain: {{ config.dns_domain }}