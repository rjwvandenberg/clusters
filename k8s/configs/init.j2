# https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-init/
# https://kubernetes.io/docs/reference/config-api/kubeadm-config.v1beta3/

apiVersion: kubeadm.k8s.io/v1beta3
kind: InitConfiguration
nodeRegistration:
  criSocket: "unix:///run/containerd/containerd.sock" 
  kubeletExtraArgs: 
    node-labels: node.{{ kubernetes.domain }}/lifetime=persistent

# skip these for now
#localAPIEndpoint:
  # advertiseAddress: # should auto detect
  # bindPort: {{ hostvars[inventory_hostname].k8s.apiserver_port }}
skipPhases: 
  - addon/kube-proxy    # skip in favor of cilium
---
apiVersion: kubeadm.k8s.io/v1beta3
kind: ClusterConfiguration
controlPlaneEndpoint: {{ kubernetes.control_plane_endpoint }}:{{ kubernetes.apiserver_port }}
networking:
  serviceSubnet: {{ kubernetes.cluster_ipv4_service_cidrs }}
  podSubnet: {{ kubernetes.cluster_ipv4_pod_cidrs }}
  dnsDomain: {{ kubernetes.dns_domain }}